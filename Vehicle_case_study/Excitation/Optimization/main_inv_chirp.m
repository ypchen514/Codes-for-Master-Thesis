%% Kriging Optimization--inverse chirp
clear
clc


global S1_krig S2_krig S3_krig S4_krig S5_krig S6_krig St1_krig St2_krig St3_krig St4_krig St5_krig St6_krig Var_krig count
global S1_est S2_est S3_est S4_est S5_est S6_est St1_est St2_est St3_est St4_est St5_est St6_est var_est

count = 0;


input = [0.04	0.04	0.04	0.04	0.04	0.04	0.08	0.08	0.08	0.08	0.08	0.08	0.12	0.12	0.12	0.12	0.12	0.12	0.16	0.16	0.16	0.16	0.16	0.16	0.2	0.2	0.2	0.2	0.2	0.2;
0.5	0.6	0.7	0.8	0.9	1	0.5	0.6	0.7	0.8	0.9	1	0.5	0.6	0.7	0.8	0.9	1	0.5	0.6	0.7	0.8	0.9	1	0.5	0.6	0.7	0.8	0.9	1
]';
lb = [0.04,0.5];
ub = [0.2,1];
fittype = 1;
SCFtype = 1;
max_variance = 1;
% S1
output_S1 = [0.02556021	0.026047086	0.027970309	0.030186003	0.032082297	0.033680228	0.026674673	0.029554346	0.032526115	0.035539518	0.038573774	0.04162466	0.049904469	0.056751874	0.063307623	0.069592715	0.075815003	0.088613703	0.060885458	0.069080376	0.078267281	0.099836532	0.142564829	0.051786304	0.064222749	0.083115737	0.148746556	0.048858764	0.03646715	0.023639911]';
S1_krig = f_variogram_fit(input, output_S1, lb, ub);
% S2
output_S2 = [0.595427434	0.601643871	0.623921168	0.631537457	0.635233284	0.636920295	0.611124627	0.613252369	0.614628138	0.615260122	0.615125051	0.614181169	0.649785393	0.659798743	0.667025682	0.670567388	0.669709818	0.207108761	0.676809455	0.67691985	0.663891212	0.576808058	0.374804622	0.821057072	0.665650028	0.610413388	0.3235478	0.878094761	0.872973928	0.916889616]';
S2_krig = f_variogram_fit(input, output_S2, lb, ub);
% S3
output_S3 = [0.292626768	0.284930699	0.253996894	0.239947799	0.230986433	0.224832634	0.261445036	0.253536517	0.246534244	0.240431867	0.235223233	0.230953654	0.204421012	0.186954405	0.172520123	0.16183282	0.155266421	0.16749231	0.168962013	0.158752908	0.159976208	0.164330421	0.150321917	0.030332239	0.173945032	0.17832302	0.141760264	0.012691186	0.011049862	0.011429052]';
S3_krig = f_variogram_fit(input, output_S3, lb, ub);
% S4
output_S4 = [0.000640079	0.000647221	0.000656276	0.000668194	0.000679888	0.000691089	0.000624827	0.000637245	0.000654014	0.000674974	0.000699997	0.000729158	0.000607049	0.000631978	0.000686039	0.000773767	0.000894412	0.025373005	0.000705348	0.000894724	0.001225971	0.001681995	0.001868091	0.000420675	0.001058881	0.001750646	0.002151184	0.00021099	0.000366819	0.001443349]';
S4_krig = f_variogram_fit(input, output_S4, lb, ub);
% S5
output_S5 = [0.049809841	0.051420182	0.060691862	0.065940428	0.06994204	0.073231085	0.067014167	0.070419332	0.073483133	0.076253872	0.078791645	0.081090526	0.064912077	0.066552206	0.067974643	0.069243877	0.070431462	0.013365089	0.064683512	0.066704436	0.068076906	0.115391976	0.25657536	0.079546364	0.065975763	0.089627255	0.314130449	0.048081422	0.03953232	0.021479349]';
S5_krig = f_variogram_fit(input, output_S5, lb, ub);
% S6
output_S6 = [0.000373656	0.000374711	0.00037736	0.000384385	0.000392605	0.000401337	0.000383421	0.000390848	0.000398839	0.000407076	0.000415277	0.000423255	0.000336202	0.000334362	0.000333421	0.000335242	0.000339731	0.02499667	0.000308012	0.00030642	0.000278499	0.0005086	0.000954417	0.000379933	0.000316616	0.000413176	0.001031776	0.0003251	0.000415364	0.00014498]';
S6_krig = f_variogram_fit(input, output_S6, lb, ub);
% St1
output_St1 = [0.030908431	0.031472972	0.033544996	0.035984668	0.038066612	0.03981719	0.031950791	0.035094037	0.038343534	0.041645626	0.044968331	0.048308896	0.057686945	0.065193704	0.072374093	0.079263992	0.086092242	0.251458185	0.069597925	0.07851998	0.08927032	0.123753167	0.193049489	0.063976971	0.073193388	0.100413878	0.194848361	0.056293278	0.060416587	0.040044936]';
St1_krig = f_variogram_fit(input, output_St1, lb, ub);
% St2
output_St2 = [0.631861252	0.637432006	0.65702965	0.663544217	0.666560045	0.667791503	0.644704405	0.646301091	0.64723845	0.647524116	0.64712465	0.646004851	0.680386238	0.689292759	0.695649121	0.698648964	0.697641318	0.477934804	0.704924634	0.704687971	0.692629934	0.607180551	0.40778246	0.829315537	0.694683394	0.641965998	0.353227319	0.886715636	0.902383987	0.933062518]';
St2_krig = f_variogram_fit(input, output_St2, lb, ub);
% St3
output_St3 = [0.325044896	0.316590778	0.282738554	0.267319284	0.25745835	0.25066844	0.290784664	0.282032023	0.274269052	0.26749326	0.261699848	0.256939564	0.228279857	0.208997572	0.193034821	0.181191371	0.173883829	0.380296196	0.18930074	0.178003735	0.178837752	0.183936539	0.172011082	0.036043741	0.195011898	0.199210347	0.163064824	0.015997583	0.03008723	0.021009914]';
St3_krig = f_variogram_fit(input, output_St3, lb, ub);
% St4
output_St4 = [0.003048122	0.00303486	0.003015907	0.003015022	0.00301687	0.003019872	0.002886567	0.002880336	0.002880462	0.002887312	0.002900557	0.002920356	0.002867595	0.002874447	0.002914948	0.003000418	0.003129655	0.149269653	0.002907179	0.003081874	0.003582589	0.004562235	0.005296701	0.002422194	0.003229142	0.004356725	0.004482913	0.002475324	0.017237225	0.008538031]';
St4_krig = f_variogram_fit(input, output_St4, lb, ub);
% St5
output_St5 = [0.052522725	0.0541095	0.063354532	0.068589529	0.072581014	0.075862192	0.069623203	0.073004317	0.076045192	0.078795128	0.081314363	0.083597274	0.067401711	0.068988656	0.070364098	0.071601577	0.072774007	0.16407437	0.067047463	0.069024488	0.070732629	0.130689117	0.299744695	0.089386214	0.068466126	0.099202887	0.353423282	0.052564841	0.056372866	0.034530046]';
St5_krig = f_variogram_fit(input, output_St5, lb, ub);
% St6
output_St6 = [0.003035856	0.003021287	0.003015401	0.003015129	0.003015764	0.003017058	0.002928317	0.002911608	0.002896326	0.002883156	0.002872021	0.002863068	0.00284278	0.002804604	0.002772178	0.00275541	0.00275536	0.166553378	0.002727669	0.002697208	0.002856669	0.004072671	0.005063478	0.002421249	0.002663008	0.003536325	0.004075035	0.002510772	0.016380166	0.007312087]';
St6_krig = f_variogram_fit(input, output_St6, lb, ub);
% Var
output_var = [6.596089628	6.384223907	4.108501684	3.758619593	3.709307825	3.787246148	2.554280235	2.614643195	2.727745905	2.877236634	3.051102681	3.241736847	2.027402621	2.154828007	2.322363401	2.531895576	2.74169023	2.927148447	2.346354685	2.483826937	2.507080515	2.64553445	3.216060247	3.216060247	2.059804315	1.985082639	2.701269185	68.33962801	47.05679241	39.36582768]';
Var_krig = f_variogram_fit(input, output_var, lb, ub);

%% Historical Data
S_1 = S1_est;
S_2 = S2_est;
S_3 = S3_est;
S_4 = S4_est;
S_5 = S5_est;
S_6 = S6_est;
St_1 = St1_est;
St_2 = St2_est;
St_3 = St3_est;
St_4 = St4_est;
St_5 = St5_est;
St_6 = St6_est;
Var = var_est;




%% plot kriging
% resolution = 100;
% [xp1, xp2] = meshgrid(lb(1,1):abs(lb(1,1)-ub(1,1))/resolution:ub(1,1), ...
%     lb(1,2):abs(lb(1,2)-ub(1,2))/resolution:ub(1,2));
% 
% xp(:,:,1) = xp1;
% xp(:,:,2) = xp2;
% xp = reshape(xp, [], 2);
% fp_krig = f_predictkrige(xp, S1_krig);
% fp_krig = reshape(fp_krig, resolution+1, resolution+1);
% 
% % figure(1)
% % hold on
% % contour(xp1, xp2, fp_krig,1000);
% % hold off
% % axis square
% figure(2)
% surf(xp1, xp2, fp_krig);
% xlabel('$x_1$','interpreter','latex');
% ylabel('$x_2$','interpreter','latex');
 
tic
%setting
options.conTol = 1e-6;
options.display = 0;
fileInfo.fName = 'obj';
%algorithm
result = UMDIRECT(fileInfo,lb,ub, options);
%result
x_best = result.xBest;
y_best = result.fBest;
toc

% best set
S1_best = f_predictkrige(x_best, S1_krig);
S2_best = f_predictkrige(x_best, S2_krig);
S3_best = f_predictkrige(x_best, S3_krig);
S4_best = f_predictkrige(x_best, S4_krig);
S5_best = f_predictkrige(x_best, S5_krig);
S6_best = f_predictkrige(x_best, S6_krig);
St1_best = f_predictkrige(x_best, St1_krig);
St2_best = f_predictkrige(x_best, St2_krig);
St3_best = f_predictkrige(x_best, St3_krig);
St4_best = f_predictkrige(x_best, St4_krig);
St5_best = f_predictkrige(x_best, St5_krig);
St6_best = f_predictkrige(x_best, St6_krig);
Var_best = f_predictkrige(x_best, Var_krig);

opt_S = [S1_best S2_best S3_best S4_best S5_best S6_best St1_best St2_best St3_best St4_best St5_best St6_best Var_best];

history = result.rect.x;


subplot(6,1,1)
Sobol_indice = [S1_best St1_best;S2_best St2_best;S3_best St3_best;S4_best St4_best;S5_best St5_best;S6_best St6_best];
bar(Sobol_indice);
set(gca, 'xticklabel', {'\theta_1','\theta_2','\theta_3','\theta_4','\theta_5','\theta_6','interpreter','latex','Fontsize',18});
ylabel('Sensitivity','Interpreter','latex','Fontsize',11)
xlabel('Uncertain Parameters','Interpreter','latex','Fontsize',11)
% h = '[$x_1^*,x_2^*$]=['+'num2str(x_best(1))'+', '+'num2str(x_best(2))+]';
h = ['[$x_1^*,x_2^*$]=[',num2str(x_best(1)),', ',num2str(x_best(2)),']',', Var = ',num2str(Var_best),' on exciting $\theta_1$'];
% title('[$x_1^*,x_2^*$]=[5.0001,0.1140,9.9997]','Interpreter','Latex','Fontsize',13);
title(h,'Interpreter','Latex','Fontsize',13);
legend('MSI','TSI','Interpreter','latex','Fontsize',13)
axis([0.514285714285714,6.485714285714286,0,0.65])


