%% Kriging Optimization--circle
clear
clc


global S1_krig S2_krig S3_krig S4_krig S5_krig S6_krig St1_krig St2_krig St3_krig St4_krig St5_krig St6_krig Var_krig count
global S1_est S2_est S3_est S4_est S5_est S6_est St1_est St2_est St3_est St4_est St5_est St6_est var_est

count = 0;


input = [2	2	2	2	2	2	2	3	3	3	3	3	3	3	4	4	4	4	4	4	4	5	5	5	5	5	5	5	6	6	6	6	6	6	6	7	7	7	7	7	7	7;
0.8	1	1.2	1.4	1.6	1.8	2	0.8	1	1.2	1.4	1.6	1.8	2	0.8	1	1.2	1.4	1.6	1.8	2	0.8	1	1.2	1.4	1.6	1.8	2	0.8	1	1.2	1.4	1.6	1.8	2	0.8	1	1.2	1.4	1.6	1.8	2
]';
lb = [2,0.8];
ub = [7,2];
fittype = 1;
SCFtype = 1;
max_variance = 1;
% S1
output_S1 = [0.000113536	0.000144123	0.00041528	0.001205379	0.002440546	0.005252136	0.010978033	0.002641617	0.004448754	0.006870148	0.009395892	0.012302955	0.015119055	0.018176834	0.00226489	0.004332351	0.005633315	0.008226818	0.0105724	0.012525898	0.015186266	0.001955386	0.00358438	0.005772683	0.00727834	0.009478019	0.011808886	0.013649161	0.002720559	0.003117284	0.005118444	0.007239289	0.009255288	0.010340291	0.012608033	0.002985458	0.003570601	0.004527691	0.006750748	0.009053	0.01129108	0.011571079]';
S1_krig = f_variogram_fit(input, output_S1, lb, ub);
% S2
output_S2 = [0.953258066	0.957109175	0.949972353	0.938294734	0.925168121	0.899952923	0.852631789	0.499282361	0.525558653	0.551939073	0.579888545	0.609117018	0.6381491	0.666703317	0.536655251	0.55766681	0.599989343	0.624058663	0.660287258	0.695984595	0.720159945	0.568334469	0.590740056	0.612000986	0.654358646	0.689154097	0.713815158	0.748068654	0.566704359	0.609212712	0.633789014	0.657610876	0.696240801	0.735259032	0.761724816	0.555590117	0.608496535	0.646982734	0.673282451	0.698325801	0.732042994	0.771180384]';
S2_krig = f_variogram_fit(input, output_S2, lb, ub);
% S3
output_S3 = [0.023576235	0.013879117	0.012976078	0.016068318	0.022171484	0.037072439	0.069674289	0.398284284	0.383431687	0.36454245	0.337709674	0.307957209	0.274835618	0.241426965	0.365224553	0.362220058	0.326745751	0.305166222	0.270836908	0.234157941	0.207114989	0.345852107	0.331737287	0.320409832	0.282889874	0.248454588	0.223966741	0.189922129	0.353298793	0.319877586	0.299688659	0.281775463	0.245662289	0.208691847	0.181151522	0.370671083	0.323834459	0.290830241	0.266947829	0.245272893	0.21277039	0.17681436]';
S3_krig = f_variogram_fit(input, output_S3, lb, ub);
% S4
output_S4 = [0.000243773	0.00015578	0.000199868	0.000321459	0.000565764	0.001244692	0.003049192	0.000688737	0.000884828	0.001212553	0.001663461	0.002267244	0.002960954	0.003759674	0.000842806	0.001086488	0.001373665	0.001801738	0.002288655	0.002798459	0.003457985	0.000910541	0.001127885	0.001461757	0.00181321	0.002224804	0.002783423	0.003275553	0.000958811	0.001152786	0.001438636	0.001845858	0.002250931	0.002654714	0.003146987	0.000986185	0.001181841	0.001436541	0.001785558	0.002248984	0.002702436	0.003092744]';
S4_krig = f_variogram_fit(input, output_S4, lb, ub);
% S5
output_S5 = [0.004450544	0.002165357	0.001846512	0.002070899	0.00261533	0.003949373	0.006719414	0.054953179	0.040642248	0.029388594	0.023625327	0.018829762	0.015989769	0.013453993	0.055650906	0.033959934	0.027329172	0.020436394	0.016399639	0.014393655	0.011182474	0.047188766	0.036152064	0.023152636	0.01891017	0.016575513	0.012222979	0.010553389	0.038694929	0.032681496	0.025856519	0.017153256	0.014372312	0.012722641	0.010789194	0.031863615	0.028492663	0.024465787	0.019665219	0.013439836	0.011383195	0.009843249]';
S5_krig = f_variogram_fit(input, output_S5, lb, ub);
% S6
output_S6 = [0.000170357	0.00020572	0.000239211	0.000261251	0.000298058	0.000399775	0.000703647	0.000454971	0.000544663	0.000641768	0.00076892	0.000903281	0.001064238	0.001224796	0.00042621	0.000488808	0.000569767	0.000667518	0.000762516	0.000877337	0.000992308	0.000395745	0.000466441	0.000530954	0.000607147	0.000704418	0.000799424	0.000889825	0.000381183	0.000441759	0.000518507	0.00058518	0.000659608	0.000752053	0.000852729	0.000376966	0.000425983	0.000497193	0.000578647	0.000648224	0.000722369	0.000809162]';
S6_krig = f_variogram_fit(input, output_S6, lb, ub);
% St1
output_St1 = [0.002457224	0.002912493	0.00486769	0.006115699	0.007256256	0.009748963	0.015524995	0.00518048	0.007193809	0.009888838	0.012769475	0.016094535	0.019430555	0.023000045	0.004737162	0.007062874	0.008555263	0.011478969	0.014142731	0.016478783	0.019635627	0.004357105	0.006219846	0.008680961	0.010395839	0.012914086	0.015668279	0.017832194	0.005240002	0.00568017	0.007950169	0.010367255	0.012662528	0.013977988	0.016646025	0.0054878	0.006195524	0.007279027	0.009809142	0.01246033	0.015011055	0.015447821]';
St1_krig = f_variogram_fit(input, output_St1, lb, ub);
% St2
output_St2 = [0.971259213	0.982592745	0.982511677	0.978147144	0.970194046	0.950916268	0.908044359	0.543917082	0.570928875	0.598198426	0.62757465	0.658314514	0.690376536	0.722056312	0.576660587	0.599014382	0.639358427	0.664686699	0.70002513	0.735931144	0.762600381	0.604832101	0.628058833	0.649840909	0.68956287	0.723515056	0.749284933	0.782394419	0.605180336	0.643873384	0.668522343	0.692570195	0.728861678	0.765725031	0.79221902	0.594443523	0.643714158	0.679378545	0.705397714	0.730456045	0.762131813	0.798675115]';
St2_krig = f_variogram_fit(input, output_St2, lb, ub);
% St3
output_St3 = [0.038006304	0.035039181	0.040159759	0.049830356	0.060445782	0.08052283	0.116819493	0.441425539	0.42697094	0.408578203	0.382614573	0.353807832	0.32290245	0.291806366	0.403656928	0.401682519	0.363908127	0.343083482	0.307395828	0.270321813	0.245022412	0.380776519	0.367160732	0.356009433	0.315528147	0.279763215	0.255827237	0.220183151	0.390094868	0.352706536	0.332216988	0.314148557	0.275321414	0.235837605	0.207751993	0.40787477	0.357184299	0.321117742	0.296534868	0.274439815	0.239496668	0.200687448]';
St3_krig = f_variogram_fit(input, output_St3, lb, ub);
% St4
output_St4 = [0.002839609	0.00330053	0.005315229	0.005867578	0.0060574	0.006313768	0.008198632	0.003010909	0.003285896	0.003753383	0.004398693	0.005257772	0.006268958	0.007543295	0.003114683	0.003483825	0.003878867	0.00446859	0.005132815	0.0058619	0.006917881	0.003136376	0.003467365	0.003942973	0.004409888	0.004958017	0.005791415	0.006536968	0.003245431	0.003457051	0.003866764	0.004446569	0.004989645	0.005533533	0.006239131	0.003261565	0.003512984	0.003832193	0.004324887	0.004988282	0.005589729	0.006122163]';
St4_krig = f_variogram_fit(input, output_St4, lb, ub);
% St5
output_St5 = [0.008313275	0.006971155	0.008382422	0.009035985	0.009503846	0.010355259	0.012850707	0.058525803	0.044375348	0.033254089	0.027710004	0.023095082	0.020487684	0.018195357	0.058782348	0.037272739	0.030700188	0.023982627	0.020011274	0.018135101	0.015180635	0.050039831	0.039194057	0.026323333	0.022114003	0.019860865	0.015710541	0.014128332	0.041614521	0.035545336	0.02885776	0.020291409	0.017546397	0.01593231	0.014113435	0.034720148	0.031333264	0.027332741	0.022657461	0.016578532	0.014557755	0.013024347]';
St5_krig = f_variogram_fit(input, output_St5, lb, ub);
% St6
output_St6 = [0.002691632	0.003066969	0.004923244	0.005225078	0.004931408	0.004256045	0.004114725	0.003123562	0.00323771	0.003416571	0.003636757	0.003909936	0.0041609	0.00452999	0.003027606	0.003178794	0.003318926	0.003491506	0.003668261	0.003848186	0.004163142	0.002938694	0.003088698	0.003249605	0.003383256	0.003522611	0.00377845	0.003991589	0.002980935	0.003025706	0.003181622	0.003367192	0.003512807	0.003651503	0.003831579	0.002935785	0.003035416	0.003131073	0.003301601	0.003505706	0.003647675	0.003781903]';
St6_krig = f_variogram_fit(input, output_St6, lb, ub);
% Var
output_var = [4890.935971	8252.003086	10058.41604	10443.55134	10790.47558	9469.123415	7649.697785	414.0333759	591.0523556	940.5683509	1325.698717	1841.178832	2447.461442	3339.903583	359.8756009	696.6264967	910.9880108	1233.823478	2085.201368	2964.173356	3910.458239	342.7134301	603.8267369	960.8491151	1410.717806	2223.718938	2735.707155	4409.11518	540.4642564	567.5616623	948.3175289	1285.153407	2415.692269	2945.517068	4330.559939	464.8125645	772.3462476	916.8592287	1433.517814	1758.118116	3655.2026	4197.925583]';
Var_krig = f_variogram_fit(input, output_var, lb, ub);

%% Historical Data
S_1 = S1_est;
S_2 = S2_est;
S_3 = S3_est;
S_4 = S4_est;
S_5 = S5_est;
S_6 = S6_est;
St_1 = St1_est;
St_2 = St2_est;
St_3 = St3_est;
St_4 = St4_est;
St_5 = St5_est;
St_6 = St6_est;
Var = var_est;




%% plot kriging
% resolution = 100;
% [xp1, xp2] = meshgrid(lb(1,1):abs(lb(1,1)-ub(1,1))/resolution:ub(1,1), ...
%     lb(1,2):abs(lb(1,2)-ub(1,2))/resolution:ub(1,2));
% 
% xp(:,:,1) = xp1;
% xp(:,:,2) = xp2;
% xp = reshape(xp, [], 2);
% fp_krig = f_predictkrige(xp, S1_krig);
% fp_krig = reshape(fp_krig, resolution+1, resolution+1);
% 
% % figure(1)
% % hold on
% % contour(xp1, xp2, fp_krig,1000);
% % hold off
% % axis square
% figure(2)
% surf(xp1, xp2, fp_krig);
% xlabel('$x_1$','interpreter','latex');
% ylabel('$x_2$','interpreter','latex');
% 
% tic
% setting
options.conTol = 1e-6;
options.display = 0;
fileInfo.fName = 'obj';
% algorithm
result = UMDIRECT(fileInfo,lb,ub, options);
% result
x_best = result.xBest;
y_best = result.fBest;
toc

% best set
S1_best = f_predictkrige(x_best, S1_krig);
S2_best = f_predictkrige(x_best, S2_krig);
S3_best = f_predictkrige(x_best, S3_krig);
S4_best = f_predictkrige(x_best, S4_krig);
S5_best = f_predictkrige(x_best, S5_krig);
S6_best = f_predictkrige(x_best, S6_krig);
St1_best = f_predictkrige(x_best, St1_krig);
St2_best = f_predictkrige(x_best, St2_krig);
St3_best = f_predictkrige(x_best, St3_krig);
St4_best = f_predictkrige(x_best, St4_krig);
St5_best = f_predictkrige(x_best, St5_krig);
St6_best = f_predictkrige(x_best, St6_krig);
Var_best = f_predictkrige(x_best, Var_krig);

opt_S = [S1_best S2_best S3_best S4_best S5_best S6_best St1_best St2_best St3_best St4_best St5_best St6_best Var_best];

history = result.rect.x;


subplot(6,1,6)
Sobol_indice = [S1_best St1_best;S2_best St2_best;S3_best St3_best;S4_best St4_best;S5_best St5_best;S6_best St6_best];
bar(Sobol_indice);
set(gca, 'xticklabel', {'\theta_1','\theta_2','\theta_3','\theta_4','\theta_5','\theta_6','interpreter','latex','Fontsize',18});
ylabel('Sensitivity','Interpreter','latex','Fontsize',11)
xlabel('Uncertain Parameters','Interpreter','latex','Fontsize',11)
% h = '[$x_1^*,x_2^*$]=['+'num2str(x_best(1))'+', '+'num2str(x_best(2))+]';
h = ['[$x_1^*,x_2^*$]=[',num2str(x_best(1)),', ',num2str(x_best(2)),']',', Var = ',num2str(Var_best),' on exciting $\theta_6$'];
% title('[$x_1^*,x_2^*$]=[5.0001,0.1140,9.9997]','Interpreter','Latex','Fontsize',13);
title(h,'Interpreter','Latex','Fontsize',13);
legend('MSI','TSI','Interpreter','latex','Fontsize',13)
axis([0.514285714285714,6.485714285714286,0,0.9])


